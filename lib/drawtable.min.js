!function(t,i){if("function"==typeof define&&define.amd)define(["exports"],i);else if("undefined"!=typeof exports)i(exports);else{var e={};i(e),t.DrawTable=e}}(this,function(a){!function(t,i){if("function"==typeof define&&define.amd)define(["exports"],i);else if(void 0!==a)i(a);else{var e={};i(e),t.DrawTable=e}}(this,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function a(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,i,e){return i&&a(t.prototype,i),e&&a(t,e),t}}(),e=function(){function s(t,i,e,a,l){var o=5<arguments.length&&void 0!==arguments[5]&&arguments[5];!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),this.title=t,this.reviceObject=i,this.titles=e,this.scoreList=a,this.baseColor=l,this.ratios=o,this.init()}return i(s,[{key:"init",value:function(){var t=this.scoreList;this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");var i=(window.devicePixelRatio||1)/(this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1);this.ratio=this.ratios?i:1,this.canvas.width=this.pixelRatio(100*(t[0].submitList.length+3)),this.canvas.height=this.pixelRatio(60*t.length),this.ctx.scale(i,i)}},{key:"drawFun",value:function(t){var i=this.drawTableHeader();this.canvas.height=this.canvas.height+this.pixelRatio(i+100+40),this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawTableHeader(),this.drawTitle(),this.drawTable(i),this.watermark(),this.convertCanvasToImage(t)}},{key:"pixelRatio",value:function(t){return t*this.ratio}},{key:"drawTitle",value:function(){this.ctx.fillStyle=this.baseColor,this.ctx.fillRect(0,0,this.canvas.width,this.pixelRatio(120)),this.ctx.font=this.pixelRatio(28)+"px Microsoft YaHei",this.ctx.textBaseline="bottom",this.ctx.fillStyle="#fff",this.ctx.textAlign="center",this.ctx.fillText(this.title,this.canvas.width/2,this.pixelRatio(60)),this.ctx.font=this.pixelRatio(22)+"px Microsoft YaHei",this.ctx.fillText(this.reviceObject,(this.canvas.width-this.pixelRatio(20))/2,this.pixelRatio(100))}},{key:"drawTableHeader",value:function(){var l=this,t=this.titles,o=[],s=this.ctx;s.textAlign="left",s.font=l.pixelRatio(22)+"px Microsoft YaHei",s.textBaseline="top",t.forEach(function(t,i){var e=120+40*i;s.fillStyle="#bee9d3",s.fillRect(0,l.pixelRatio(e),l.canvas.width,l.pixelRatio(40)),s.fillStyle="#000";var a="作业"+(i+1);s.fillText(a+": "+t,l.pixelRatio(10),l.pixelRatio(e+6)),o.push(a)});var i=["序号","姓名"].concat(o,["总分"]),e=40*t.length+120;return s.fillStyle="#bee2d9",s.fillRect(0,l.pixelRatio(e),l.canvas.width,l.pixelRatio(60)),i.forEach(function(t,i){s.fillStyle="#000",s.fillText(t,l.pixelRatio(100*i+20),l.pixelRatio(e+14))}),40*t.length+60}},{key:"drawTable",value:function(t){var a=this,i=this.canvas,l=this.ctx,e=this.scoreList;l.textBaseline="bottom",this.arraySortFun(e);for(var o=0,s=e.length;o<s;o++){var n=60*o+120+t;l.fillStyle=o%2==0?"#f8f8f8":"#fffffa",l.fillRect(0,this.pixelRatio(n),i.width-this.pixelRatio(20),this.pixelRatio(60)),l.font=this.pixelRatio(20)+"px Microsoft YaHei",l.fillStyle="#000",l.textAlign="center",l.fillText(o+1,this.pixelRatio(40),this.pixelRatio(n+46)),l.fillText(e[o].name,this.pixelRatio(150),this.pixelRatio(n+46),this.pixelRatio(100));var h=e[o].submitList,r=0;h.forEach(function(t,i){l.font=a.pixelRatio(20)+"px Microsoft YaHei",l.fillStyle="#000",r++;var e="";t.isSubmit?66!=t.moduleId||t.hasQuestion?(e=t.actualScore,l.fillText(e,a.pixelRatio(100*(i+2)+50),a.pixelRatio(n+46),a.pixelRatio(100))):l.fillText("已提交",a.pixelRatio(100*(i+2)+50),a.pixelRatio(n+46),a.pixelRatio(100)):(l.fillStyle="#f00",e="未提交",l.fillText(e,a.pixelRatio(100*(i+2)+50),a.pixelRatio(n+46),a.pixelRatio(100)))}),l.font=a.pixelRatio(20)+"px Microsoft YaHei",l.fillStyle="#000",l.fillText(e[o].totalScore?e[o].totalScore:0,this.pixelRatio(100*(r+2)+50),this.pixelRatio(n+46))}}},{key:"arraySortFun",value:function(t){for(var i={},e=0,a=t.length;e<a;e++)for(var l=t.length-1;e<l;l--)t[l].totalScore>t[l-1].totalScore&&(i=t[l],t[l]=t[l-1],t[l-1]=i);this.scoreList=t}},{key:"watermark",value:function(){var t=this.canvas,i=this.ctx,e=t.width+400,a=t.height+200,l="习习向上 "+(new Date).getFullYear();i.font=this.pixelRatio(40)+"px Microsoft YaHei",i.textBaseline="bottom",i.fillStyle="rgba(0,186,143,0.1)",i.translate(.5*e,.5*a),i.rotate(-20*Math.PI/180),i.translate(-.5*e,-.5*a);for(var o=0;o<a;o+=200)for(var s=o%400==0?200:0;s<e;s+=400)i.fillText(l,this.pixelRatio(s),this.pixelRatio(o))}},{key:"convertCanvasToImage",value:function(t){var i=this.canvas,e=document.createElement("canvas"),a=e.getContext("2d");e.width=i.width+20,e.height=i.height+20,a.fillStyle="#fff",a.fillRect(0,0,e.width,e.height),a.drawImage(i,10,10,i.width,i.height),t(e.toDataURL("image/jpeg",1))}}]),s}();t.default=e})});