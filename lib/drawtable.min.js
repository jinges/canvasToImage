!function(t,i){if("function"==typeof define&&define.amd)define(["exports"],i);else if("undefined"!=typeof exports)i(exports);else{var e={};i(e),t.DrawTable=e}}(this,function(a){!function(t,i){if("function"==typeof define&&define.amd)define(["exports"],i);else if(void 0!==a)i(a);else{var e={};i(e),t.DrawTable=e}}(this,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function a(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,i,e){return i&&a(t.prototype,i),e&&a(t,e),t}}(),e=function(){function s(t,i,e,a,l){var o=5<arguments.length&&void 0!==arguments[5]&&arguments[5];!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),this.title=t,this.reviceObject=i,this.titles=e,this.scoreList=a,this.baseColor=l,this.ratios=o,this.init()}return i(s,[{key:"init",value:function(){var t=this.scoreList;this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");var i=(window.devicePixelRatio||1)/(this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1);this.ratio=this.ratios?i:1,this.canvas.width=this.pixelRatio(100*(t[0].submitList.length+3)),this.canvas.height=this.pixelRatio(60*t.length),this.ctx.scale(i,i)}},{key:"drawFun",value:function(t){var i=this.drawTableHeader();this.canvas.height=this.canvas.height+this.pixelRatio(i+100+40),this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.addLoading(),this.drawTableHeader(),this.drawTitle(),this.drawTable(i),this.watermark(),this.convertCanvasToImage(t)}},{key:"pixelRatio",value:function(t){return t*this.ratio}},{key:"drawTitle",value:function(){this.ctx.fillStyle=this.baseColor,this.ctx.fillRect(this.pixelRatio(10),this.pixelRatio(10),this.canvas.width-this.pixelRatio(20),this.pixelRatio(120)),this.ctx.font=this.pixelRatio(28)+"px Microsoft YaHei",this.ctx.textBaseline="bottom",this.ctx.fillStyle="#fff",this.ctx.textAlign="center",this.ctx.fillText(this.title,this.canvas.width/2,this.pixelRatio(60)),this.ctx.font=this.pixelRatio(22)+"px Microsoft YaHei",this.ctx.fillText(this.reviceObject,(this.canvas.width-this.pixelRatio(20))/2,this.pixelRatio(100))}},{key:"drawTableHeader",value:function(){var l=this,t=this.titles,o=0;return l.ctx.textBaseline="bottom",l.ctx.textAlign="center",t.forEach(function(t,i){var e=Math.ceil(t.length/8);o<24*(e+1)&&(o=24*(e+1)),l.ctx.fillStyle="#bee9d3",l.ctx.fillRect(l.pixelRatio(10),l.pixelRatio(120),l.canvas.width-l.pixelRatio(20),l.pixelRatio(o))}),t.forEach(function(t,i){l.ctx.font=l.pixelRatio(22)+"px Microsoft YaHei";var e=Math.ceil(t.length/8);if(1<e){l.ctx.font=l.pixelRatio(16)+"px Microsoft YaHei",l.ctx.textBaseline="middle";for(var a=0;a<e;a++)l.ctx.fillStyle="#000",l.ctx.fillText(t.substr(8*a,8),l.pixelRatio(100*i+50),l.pixelRatio(150+24*a),l.pixelRatio(100))}else l.ctx.fillStyle="#000",l.ctx.textBaseline="middle",l.ctx.fillText(t,l.pixelRatio(100*i+50),l.pixelRatio(120+o/2),l.pixelRatio(100))}),o}},{key:"drawTable",value:function(t){var a=this,i=this.canvas,l=this.ctx,e=this.scoreList;l.textBaseline="bottom",this.arraySortFun(e);for(var o=0,s=e.length;o<s;o++){var n=60*o+120+t;l.fillStyle=o%2==0?"#f8f8f8":"#fffffa",l.fillRect(this.pixelRatio(10),this.pixelRatio(n),i.width-this.pixelRatio(20),this.pixelRatio(60)),l.font=this.pixelRatio(20)+"px Microsoft YaHei",l.fillStyle="#000",l.textAlign="center",l.fillText(o+1,this.pixelRatio(50),this.pixelRatio(n+46)),l.fillText(e[o].name,this.pixelRatio(150),this.pixelRatio(n+46),this.pixelRatio(100));var c=e[o].submitList,r=0;c.forEach(function(t,i){l.font=a.pixelRatio(20)+"px Microsoft YaHei",l.fillStyle="#000",r++;var e="";t.isSubmit?66!=t.moduleId||t.hasQuestion?(e=t.actualScore,l.fillText(e,a.pixelRatio(100*(i+2)+50),a.pixelRatio(n+46),a.pixelRatio(100))):l.fillText("已提交",a.pixelRatio(100*(i+2)+50),a.pixelRatio(n+46),a.pixelRatio(100)):(l.fillStyle="#f00",e="未提交",l.fillText(e,a.pixelRatio(100*(i+2)+50),a.pixelRatio(n+46),a.pixelRatio(100)))}),l.font=a.pixelRatio(20)+"px Microsoft YaHei",l.fillStyle="#000",l.fillText(e[o].totalScore?e[o].totalScore:0,this.pixelRatio(100*(r+2)+50),this.pixelRatio(n+46))}l.beginPath(),l.strokeStyle="#f8f8f8",l.lineWidth=this.pixelRatio(1),l.strokeRect(this.pixelRatio(10),this.pixelRatio(120+t),i.width-this.pixelRatio(20),i.height-this.pixelRatio(140+t)),l.save()}},{key:"arraySortFun",value:function(t){for(var i={},e=0,a=t.length;e<a;e++)for(var l=t.length-1;e<l;l--)t[l].totalScore>t[l-1].totalScore&&(i=t[l],t[l]=t[l-1],t[l-1]=i);this.scoreList=t}},{key:"watermark",value:function(){var t=this.canvas,i=this.ctx,e=t.width+400,a=t.height+200,l="习习向上 "+(new Date).getFullYear();i.font=this.pixelRatio(40)+"px Microsoft YaHei",i.textBaseline="bottom",i.fillStyle="rgba(0,186,143,0.1)",i.translate(.5*e,.5*a),i.rotate(-20*Math.PI/180),i.translate(-.5*e,-.5*a);for(var o=0;o<a;o+=200)for(var s=o%400==0?200:0;s<e;s+=400)i.fillText(l,this.pixelRatio(s),this.pixelRatio(o))}},{key:"addLoading",value:function(){var t=document.querySelector("#loading");console.log(new Date),t&&(t.style.display="block")}},{key:"removeLoading",value:function(){var t=document.querySelector("#loading");console.log(new Date),t&&(t.style.display="none")}},{key:"convertCanvasToImage",value:function(t){t(this.canvas.toDataURL("image/jpeg",1))}},{key:"closeImagePanel",value:function(){var t=document.getElementById("canvasImg");t.addEventListener("click",function(){t.remove(),document.body.removeAttribute("style")},!0)}}]),s}();t.default=e})});