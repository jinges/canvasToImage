!function(t,i){if("function"==typeof define&&define.amd)define(["exports"],i);else if("undefined"!=typeof exports)i(exports);else{var e={};i(e),t.DrawTable=e}}(this,function(a){!function(t,i){if("function"==typeof define&&define.amd)define(["exports"],i);else if(void 0!==a)i(a);else{var e={};i(e),t.DrawTable=e}}(this,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function a(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(t,i,e){return i&&a(t.prototype,i),e&&a(t,e),t}}(),e=function(){function s(t,i,e,a,o,l){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),this.title=t,this.reviceObject=i,this.titles=e,this.scoreList=a,this.baseColor=o,this.ratios=l||!1,this.init()}return i(s,[{key:"init",value:function(){var t=this.scoreList;this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d");var i=(window.devicePixelRatio||1)/(this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1);this.ratio=this.ratios?i:1,this.canvas.width=this.pixelRatio(100*(t[0].submitList.length+3)),this.canvas.height=this.pixelRatio(60*t.length),this.ctx.scale(i,i)}},{key:"drawFun",value:function(t){var i=this.drawTableHeader();this.canvas.height=this.canvas.height+this.pixelRatio(i+100+40),this.ctx.fillStyle="#fff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.addLoading(),this.drawTableHeader(),this.drawTitle(),this.drawTable(i),this.watermark(),this.convertCanvasToImage(t),this.closeImagePanel()}},{key:"pixelRatio",value:function(t){return t*this.ratio}},{key:"drawTitle",value:function(){this.ctx.fillStyle=this.baseColor,this.ctx.fillRect(this.pixelRatio(10),this.pixelRatio(10),this.canvas.width-this.pixelRatio(20),this.pixelRatio(120)),this.ctx.font=this.pixelRatio(28)+"px Microsoft YaHei",this.ctx.textBaseline="bottom",this.ctx.fillStyle="#fff",this.ctx.textAlign="center",this.ctx.fillText(this.title,this.canvas.width/2,this.pixelRatio(60)),this.ctx.font=this.pixelRatio(22)+"px Microsoft YaHei",this.ctx.fillText(this.reviceObject,(this.canvas.width-this.pixelRatio(20))/2,this.pixelRatio(100))}},{key:"drawTableHeader",value:function(){var o=this,t=this.titles,l=0;return o.ctx.textBaseline="bottom",o.ctx.textAlign="center",t.forEach(function(t,i){var e=Math.ceil(t.length/8);l<24*(e+1)&&(l=24*(e+1)),o.ctx.fillStyle="#bee9d3",o.ctx.fillRect(o.pixelRatio(10),o.pixelRatio(120),o.canvas.width-o.pixelRatio(20),o.pixelRatio(l))}),t.forEach(function(t,i){o.ctx.font=o.pixelRatio(22)+"px Microsoft YaHei";var e=Math.ceil(t.length/8);if(1<e){o.ctx.font=o.pixelRatio(16)+"px Microsoft YaHei",o.ctx.textBaseline="middle";for(var a=0;a<e;a++)o.ctx.fillStyle="#000",o.ctx.fillText(t.substr(8*a,8),o.pixelRatio(100*i+50),o.pixelRatio(150+24*a),o.pixelRatio(100))}else o.ctx.fillStyle="#000",o.ctx.textBaseline="middle",o.ctx.fillText(t,o.pixelRatio(100*i+50),o.pixelRatio(120+l/2),o.pixelRatio(100))}),l}},{key:"drawTable",value:function(t){var a=this,i=this.canvas,o=this.ctx,e=this.scoreList;o.textBaseline="bottom",this.arraySortFun(e);for(var l=0,s=e.length;l<s;l++){var n=60*l+120+t;o.fillStyle=l%2==0?"#f8f8f8":"#fffffa",o.fillRect(this.pixelRatio(10),this.pixelRatio(n),i.width-this.pixelRatio(20),this.pixelRatio(60)),o.font=this.pixelRatio(20)+"px Microsoft YaHei",o.fillStyle="#000",o.textAlign="center",o.fillText(l+1,this.pixelRatio(50),this.pixelRatio(n+46)),o.fillText(e[l].name,this.pixelRatio(150),this.pixelRatio(n+46),this.pixelRatio(100));var c=e[l].submitList,r=0;c.forEach(function(t,i){o.font=a.pixelRatio(20)+"px Microsoft YaHei",o.fillStyle="#000",r++;var e="";t.isSubmit?66==t.moduleId?t.trueCount||t.falseCount?(o.font=a.pixelRatio(14)+"px Microsoft YaHei",e=" "+t.trueCount+"√ | "+t.falseCount+"× "):e="已提交":e=t.actualScore:(o.fillStyle="#f00",e="未提交"),o.fillText(e,a.pixelRatio(100*(i+2)+50),a.pixelRatio(n+46),a.pixelRatio(100))}),o.font=a.pixelRatio(20)+"px Microsoft YaHei",o.fillStyle="#000",o.fillText(e[l].totalScore?e[l].totalScore:0,this.pixelRatio(100*(r+2)+50),this.pixelRatio(n+46))}o.beginPath(),o.strokeStyle="#f8f8f8",o.lineWidth=this.pixelRatio(1),o.strokeRect(this.pixelRatio(10),this.pixelRatio(120+t),i.width-this.pixelRatio(20),i.height-this.pixelRatio(140+t)),o.save()}},{key:"arraySortFun",value:function(t){for(var i={},e=0,a=t.length;e<a;e++)for(var o=t.length-1;e<o;o--)t[o].totalScore>t[o-1].totalScore&&(i=t[o],t[o]=t[o-1],t[o-1]=i);this.scoreList=t}},{key:"watermark",value:function(){var t=this.canvas,i=this.ctx,e=t.width+400,a=t.height+200,o="习习向上 "+(new Date).getFullYear();i.font=this.pixelRatio(40)+"px Microsoft YaHei",i.textBaseline="bottom",i.fillStyle="rgba(0,186,143,0.1)",i.translate(.5*e,.5*a),i.rotate(-20*Math.PI/180),i.translate(-.5*e,-.5*a);for(var l=0;l<a;l+=200)for(var s=l%400==0?200:0;s<e;s+=400)i.fillText(o,this.pixelRatio(s),this.pixelRatio(l))}},{key:"addLoading",value:function(){var t=document.querySelector("#loading");console.log(new Date),t&&(t.style.display="block")}},{key:"removeLoading",value:function(){var t=document.querySelector("#loading");console.log(new Date),t&&(t.style.display="none")}},{key:"convertCanvasToImage",value:function(t){var i=this.canvas,e=new Image,a=window.screen.height,o=window.screen.width*i.height/i.width,l=document.createElement("div");if(l.style.cssText="position: fixed; width: 100%; height: 100%; left: 0; top: 0; overflow-y: auto;background: #fff;",l.setAttribute("id","canvasImg"),e.src=i.toDataURL("image/jpeg",1),o<a){var s=(a-o)/2;e.style.marginTop=s+"px"}l.appendChild(e),document.body.appendChild(l),document.body.style.cssText="height: 0px; overflow: hidden;",this.removeLoading()}},{key:"closeImagePanel",value:function(){var t=document.getElementById("canvasImg");t.addEventListener("click",function(){t.remove(),document.body.removeAttribute("style")},!0)}}]),s}();t.default=e})});