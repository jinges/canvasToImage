<!DOCTYPE html>
<html>
<head>
	<title>canvas</title>
</head>
<body>
<canvas id="tutorial" width="150" height="150"></canvas>
<script type="text/javascript">
	var data = [{
		name: '张三',
		score: [23,56,89,55,99,100]
	}, {
		name: '李四',
		score: [88,78,56,0,45,13]
	}, {
		name: '王五',
		score: [28,8,56,67,45,83]
	},{
		name: '张三',
		score: [23,56,89,55,99,100]
	}, {
		name: '李四',
		score: [88,78,56,0,45,13]
	}, {
		name: '王五',
		score: [28,8,56,67,45,83]
	},{
		name: '张三',
		score: [23,56,89,55,99,100]
	}, {
		name: '李四',
		score: [88,78,56,0,45,13]
	}, {
		name: '王五',
		score: [28,8,56,67,45,83]
	},{
		name: '张三张三',
		score: [23,56,89,55,99,100]
	}, {
		name: '李四',
		score: [88,78,56,0,45,13]
	}, {
		name: '王五',
		score: [28,8,56,67,45,83]
	},{
		name: '张三',
		score: [23,56,89,55,99,100]
	}, {
		name: '李四李四',
		score: [88,78,56,0,45,13]
	}, {
		name: '王五',
		score: [28,8,56,67,45,83]
	},{
		name: '张三',
		score: [23,56,89,55,99,100]
	}, {
		name: '李四',
		score: [88,78,56,0,45,13]
	}, {
		name: '王五王五',
		score: [28,8,56,67,45,83]
	}]

	var title = '英语作业英语作业英语作英语作业英语作业英';
	var reviceObject = '三年级二班';
	var tableHeaderData = ['序号','姓名','试卷一试卷一试卷一试卷一试卷一','试卷2','Section A, 1b-新目标八年级上学期Unit 1 Where did go on vacation?','试卷4','试卷5','试卷6', '总分']
	
	

	function canvas(){
		debugger
		var canvas = document.getElementById('tutorial');
		var ctx = canvas.getContext('2d');
		canvas.width = (data[0].score.length + 3) * 100;
		canvas.height = data.length * 60;

		drawTitle(canvas, ctx);
		var height = drawTableHeader(canvas, ctx);
		drawTable(canvas, ctx, height);
		watermark(canvas, ctx, height);

		convertCanvasToImage(canvas)
	}

	function drawTitle(canvas, ctx){
		ctx.fillStyle="#00ba8f";
		ctx.fillRect(0, 0, canvas.width, 120);
		ctx.font = "32px Microsoft YaHei";
		ctx.textBaseline="bottom";
		ctx.fillStyle = '#fff';
		ctx.textAlign="center";
		ctx.fillText(title, canvas.width / 2,  60);

		ctx.font = "24px Microsoft YaHei";
		ctx.fillText(reviceObject, canvas.width / 2,  100);
	}

	function drawTableHeader(canvas, ctx){
		var height = 0;
		ctx.textBaseline="bottom";
		ctx.textAlign="center";
		tableHeaderData.forEach(function(item, i){
			var num = 8;
			var rows = Math.ceil(item.length / num);
			if(height < 22 * (rows + 1)) {
				height = 22 * (rows + 1);
			}
			ctx.fillStyle="#a1e2d3";
			ctx.fillRect(0, 120, canvas.width, height);

		})

		tableHeaderData.forEach(function(item, i){
			ctx.font = "20px Microsoft YaHei";
			var num = 8;
			var rows = Math.ceil(item.length / num);

			if(rows > 1) {
				ctx.font = "18px Microsoft YaHei";
				ctx.textBaseline="bottom";
				for(var j=0; j < rows; j++) {
					ctx.fillStyle = '#000';
					ctx.fillText(item.substr(num * j, 8), 100 * i + 50, 150 + j * 22, 100)
				}
			} else {
				ctx.fillStyle = '#000';
				ctx.textBaseline="middle";
				ctx.fillText(item, 100 * i + 50, 160, 100)
			}
		})
		return height;
	}

	function drawTable(canvas, ctx, height){
		ctx.font = "20px Microsoft YaHei";
		ctx.textBaseline="bottom";
		for(var i=0,len=data.length; i< len; i++) {
			var top = 60 * (i+1) + 100 + height;
			if(i%2 == 0) {
				ctx.fillStyle="#f8f8f8";
				ctx.fillRect(0, top - 40, canvas.width, 60)
			}
			ctx.fillStyle = '#000';
			ctx.textAlign="center";
			ctx.fillText((i+1), 50,  top)
			ctx.fillText(data[i].name, 100 + 50,  top)
			var score = data[i].score;
			var totalScore = 0;
			var scoreLen = 0;
			score.forEach(function(item, key){
				totalScore+=item;
				scoreLen++;
				ctx.fillText(item, 100 * (key + 2) + 50, top)
			})
			ctx.fillText(totalScore, 100*(scoreLen+2) + 50, top)
		}
	}

	function watermark(canvas, ctx, height){
		ctx.font = "120px Microsoft YaHei";
		ctx.textBaseline="bottom";
		ctx.fillStyle="rgba(0,186,143,1)";
		ctx.globalAlpha=0.3;
		// ctx.rotate(-20*Math.PI/180)
		// ctx.fillText('习习向上', canvas.width / 2 - 240, (height + 100 + canvas.height) / 2)
		var img = new Image();
		img.src = './girl.png';
		img.onload = function (){
			ctx.drawImage(img, canvas.width / 2, canvas.height / 2)
		}
	}

	function convertCanvasToImage(canvas) {
		var image = new Image();
		image.src = canvas.toDataURL("image/png");
		document.body.appendChild(image)
	}

	canvas();
	
        
</script>
</body>
</html>